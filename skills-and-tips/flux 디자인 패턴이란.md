# Flux 패턴이란?

### 1. Flux 간략한 소개

### ![Flux](https://k.kakaocdn.net/dn/lmfPW/btqBQnTPgIs/Z1jmHHdNcOTNiu93kQ9gMk/img.png)

Flux란 데이터가 단방향으로 흐르는 디자인 패턴으로, 양방향 데이터 흐름에서 생기는 오류에 대한 문제의식에서 출발했다. 주로 MVC 패턴과 함께 사용한다. 데이터는 우선 데이터를 저장하는 Store에서 데이터를 활용해 화면을 나타내는 View로 전달된다. 만약 View나 다른 어딘가에서 Store에 저장된 데이터를 변경하고 싶으면, 데이터 변경에 대한 정보가 담긴 Action 객체를 만든다. 그리고 Action 객체를 받아 Store에 데이터를 전달하는 Dispatcher를 통해 스토어를 업데이트한다. 

이 때 아무도 Store의 데이터에 직접 접근해 값을 변경하지는 않는다. 대신, store에 저장된 현재 데이터값(state라고 부른다)과 Action 객체를 바탕으로 새로운 State를 만들고, 새로 만들어진 값으로 store의 state를 대체한다. 또한 Dispatcher는 애플리케이션마다 유일하며, 서로 다른 액션을 순서에 따라 교통정리해 store로 보내는 역할을 한다.

### 2. 양방향 데이터 흐름의 오류?

시간이 흐르면서 애플리케이션은 점점 복잡해지고, 사용하는 데이터는 실시간으로 변하고, 이를 참조하는 수많은 구성요소들로 이루어지게 된다. 게다가 MVC 패턴에서 특정 구성요소가 하나의 모델만을 참조하지도 않는다. 예를 들어 하나의 컴포넌트가 여러 DB의 정보를 따와 보여주면서, 동시에 여러 DB의 데이터값을 실시간으로 바꿀 수도 있고, 한 DB가 다른 DB의 데이터를 업데이트할 수도 있다. 이런 방식으로는 데이터의 흐름이 복잡한 거미줄처럼 얽히고, 애플리케이션의 구성요소들은 데이터 흐름 때문에 서로 의존하게 된다. 그런데 앱의 구성요소를 추가하거나 변경할 일이 생겼다고 하자. 내가 수정하고 싶은 건 단순히 컴포넌트 하나일 뿐인데, 데이터 흐름이 꼬여 에러가 나지 않게 거기에 얽혀있는 수많은 다른 요소들을 전부 고려하는 건 쉬운 일이 아니다. 실제로 애플리케이션이 복잡해질수록 구성요소 사이에 가능한 연결의 수가 늘어나니, 버그의 가능성도 기하급수적으로 증가한다. 그래서 데이터를 참조하는 구성요소가 여럿이라도, 데이터의 흐름을 단순하고 추적하기 쉽게 만들 필요성이 생겼다.

### 3. flux 패턴의 주요 구성요소

#### 액션 생성자

store에 저장된 데이터값에 변화를 주고 싶으면 항상 dispatcher를 거쳐야 한다. 액션 생성자는 어떤 변화를 어떤 값을 활용해 일으킬지 알리는 action 객체를 만든다. 그리고 dispatcher에 미리 정해둔 형식에 맞게 생성해 디스패쳐에 넘겨준다. 액션 객체가 갖는 값은 일반적으로 type과 payload다. type은 dispatcher에게 store에 어떤 종류의 변화를 일으킬지를 알려준다. payload는 store에 넘겨줄 새로운 state를 만들 때 참조할 값이다.

#### 디스패쳐

디스패쳐는 애플리케이션에서 쓰이는 스토어들을 등록한다. 그리고 액션 생성자에게서 받은 액션 객체를 스토어로 보내주는 택배기사와 같은 역할을 한다. flux 패턴에서는 스토어가 특정 액션만 구독하지 않고 모든 액션을 받고 난 뒤 버릴지를 결정한다.

#### 스토어

스토어는 데이터가 저장되는 공간이다. 또한 디스패쳐에서 받은 액션 객체의 정보로 자신의 데이터를 업데이트한다. 스토어의 내부에서는 switch문을 이용해 액션의 처리 여부와 데이터에 행할 업데이트의 종류를 결정한다. 액션을 처리하기로 결정되었다면, 액션에 실려온 데이터를 바탕으로 새로운 상태를 만들어 업데이트한다. 그리고 state update가 일어나면 변경 이벤트를 내보내 컨트롤러 뷰에 업데이트 사실을 알려준다.

#### 뷰, 컨트롤러 뷰

뷰는 스토어에서 데이터를 받아 처리한 뒤 화면에 띄워준다. 그런데 스토어의 데이터가 변할 때마다, 변화 사실을 감지하고 변한 데이터를 바탕으로 실시간으로 뷰를 업데이트해줘야 한다. 이 때 스토어와 뷰 사이에서 중간 관리자 역할을 하는 컨트롤러 뷰가 스토어에게서 변경 이벤트를 받아 변화를 감지하고, 스토어에서 새로운 값을 가져와 뷰에 알려준다.

### 4. Redux의 구성요소와 flux 패턴

Redux를 구성하는 주요 요소는 Store, Dispatcher, Reducer, Action generator, Action이다. Flux의 Store에 해당하는 개념은 Reducer와 Store다. 먼저 Store는 애플리케이션의 뿌리에 등록되고 값을 저장한다. Reducer는 Store에 연결되어 state 값을 받아오고, action 객체에 맞게 새로운 state를 만들어 store에 전달한다. Redux의 dispatcher는 flux의 dispatcher와 유사하다. 이 때 react-redux의 connect를 통해 store를 직접 구독하며 변화를 탐지하지 않아도 store와 컴포넌트를 연동할 수 있다. view에서 액션 생성함수를 바탕으로 액션 객체를 만들어(일반 뷰를 둘러싸 데이터만을 따로 처리하는 container view에서 담당하기도 한다.) dispatcher를 통해 reducer로 보낸다. 

(이해한 내용이 좀 틀릴 수도 있음)